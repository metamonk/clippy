# Engineering Backlog

This backlog collects cross-cutting or future action items that emerge from reviews and planning.

Routing guidance:

- Use this file for non-urgent optimizations, refactors, or follow-ups that span multiple stories/epics.
- Must-fix items to ship a story belong in that story's `Tasks / Subtasks`.
- Same-epic improvements may also be captured under the epic Tech Spec `Post-Review Follow-ups` section.

| Date | Story | Epic | Type | Severity | Owner | Status | Notes |
| ---- | ----- | ---- | ---- | -------- | ----- | ------ | ----- |
| 2025-10-27 | 1.2 | 1 | TechDebt | Med | SM/PM | Open | Wire menu actions (Import, Save, Undo, Redo, Close) to Tauri commands. Menu structure exists in src-tauri/src/lib.rs:72-123 but items have no event handlers. Story 1.2 intentionally left these non-functional. Reference: Story 1.3+ should implement File→Import handler. |
| 2025-10-27 | 1.2 | 1 | Enhancement | Low | Developer | Open | Add aria-describedby to layout panel empty states for improved screen reader support. Files: src/components/layout/*.tsx. Example: add unique IDs to empty state paragraphs and reference via aria-describedby attribute. |
| 2025-10-27 | 1.2 | 1 | Enhancement | Low | Developer | Open | Enable stricter TypeScript compiler options (strict: true, noUncheckedIndexedAccess: true) in tsconfig.json to catch more type errors at compile time. |
| 2025-10-27 | 1.3 | 1 | TechDebt | Low | Developer | Open | Add path traversal validation - Canonicalize paths and validate against allowlist in src-tauri/src/commands/media.rs:16. Low risk due to Tauri sandbox but explicit validation is best practice. |
| 2025-10-27 | 1.3 | 1 | Enhancement | Low | Developer | Open | Add resource limits for imports - Max file size (5GB) and concurrent import limit (3) to prevent resource exhaustion. File: src-tauri/src/commands/media.rs. |
| 2025-10-27 | 1.3 | 1 | TechDebt | Low | Developer | Open | Add integration test with real video file - Create minimal valid MP4 for end-to-end FFmpeg metadata extraction test. Current tests only use dummy files. |
| 2025-10-27 | 1.3 | 1 | TechDebt | Low | Developer | Open | Improve test consistency - Either use Vitest globals everywhere or explicit imports everywhere. Currently mixing both patterns across test files. |
| 2025-10-27 | 1.4 | 1 | TechDebt | Med | Developer | Open | Explicit Video.js event listener cleanup - Extract event handlers to named functions and unregister in cleanup. File: src/components/player/VideoPlayer.tsx:64-86. Prevents potential memory leaks in edge cases. |
| 2025-10-27 | 1.4 | 1 | TechDebt | Med | Developer | Open | Resolve time unit inconsistency - Clarify documentation about seconds vs milliseconds, add conversion utilities if needed. Files: src/lib/utils/timeUtils.ts, src/stores/playerStore.ts. MediaFile.duration uses milliseconds but playerStore uses seconds. |
| 2025-10-27 | 1.4 | 1 | Enhancement | Low | Developer | Open | Optimize useEffect dependencies - Remove stable Zustand actions from dependencies, wrap callbacks in useCallback. File: src/components/player/VideoPlayer.tsx:89. Prevents unnecessary re-initialization. |
| 2025-10-27 | 1.4 | 1 | Enhancement | Low | Developer | Open | Enhance error handling with toast notifications - Add toast notifications for Video.js errors using sonner. File: src/components/player/VideoPlayer.tsx:83-85. Improves user experience. |
| 2025-10-27 | 1.4 | 1 | Enhancement | Low | Developer | Open | Add integration test for complete player flow - Add E2E test: MediaItem click → store update → VideoPlayer renders → plays. Validates complete feature integration. |
| 2025-10-27 | 1.6 | 1 | TechDebt | Low | Developer | Open | Refactor timeline store duration calculation to DRY helper function - Extract `_calculateTotalDuration(tracks: Track[]): number` in src/stores/timelineStore.ts. Repeated 5 times across addClip, removeClip, updateClip, removeTrack, recalculateDuration (lines 86-92, 112-118, 144-151, 198-204, 230-236). |
| 2025-10-27 | 1.6 | 1 | Enhancement | Low | Developer | Open | Add upper bound validation for timeline drop positions - Add validation/warning for extreme positions (e.g., > 24 hours) in src/components/timeline/Timeline.tsx:48-90 (handleDrop). Currently only prevents negative via Math.max(0, dropTimeMs). |
| 2025-10-27 | 1.6 | 1 | TechDebt | Med | Developer | Open | Add Tauri API mocks to test setup - Mock `window.__TAURI_INTERNALS__` in src/test/setup.ts to eliminate 18 unhandled promise rejections from @tauri-apps/api/event.js:77. Prevents test errors from masking real failures. |
| 2025-10-27 | 1.6 | 1 | TechDebt | Med | Developer | Open | Wrap MediaLibraryPanel test state updates in act() - Fix React state update warnings in src/components/media-library/MediaLibraryPanel.test.tsx. Use act() or waitFor() from @testing-library/react for state-changing interactions. |
| 2025-10-27 | 1.6 | 1 | Enhancement | Low | Developer | Open | Add useMemo for timeline width calculation - Optimize src/components/timeline/Timeline.tsx:40-43 to prevent recalculation on every render. Defer to Story 3.6 (Timeline Zoom) performance work. |
| 2025-10-27 | 1.7 | 1 | TechDebt | Low | Developer | Open | Add Tauri mock utilities to test setup - Mock `window.__TAURI_INTERNALS__` in src/test/setup.ts to suppress 18 unhandled rejection warnings from @tauri-apps/api. Cleaner test output, easier to spot real errors. |
| 2025-10-27 | 1.7 | 1 | Enhancement | Low | Developer | Open | Add explicit performance test for scrubbing latency - Measure time between drag event and video seek completion in src/components/timeline/Timeline.test.tsx. Explicit validation of NFR001 (< 100ms target). |
| 2025-10-27 | 1.7 | 1 | TechDebt | Low | Developer | Open | Wrap state updates in act() for MediaLibraryPanel tests - Use `act()` wrapper for file removal test in src/components/media-library/MediaLibraryPanel.test.tsx to eliminate test pollution warnings. |
| 2025-10-27 | 1.8 | 1 | Enhancement | Low | Developer | Open | Consider debouncing updateClip during drag - Update visual feedback immediately via local state, commit to store on drag end. Could optimize for very large timelines. File: src/components/timeline/TimelineClip.tsx:107-120, 138-152. Estimate: 1-2 hours. |
| 2025-10-27 | 1.8 | 1 | TechDebt | Low | Developer | Open | Extract magic number MIN_TRIM_GAP_MS - Replace hard-coded 100ms with named constant: `const MIN_TRIM_GAP_MS = 100; // Minimum gap to prevent zero-duration clips`. File: src/components/timeline/TimelineClip.tsx:117, 149. Estimate: 5 minutes. |
| 2025-10-27 | 1.8 | 1 | TechDebt | Low | Developer | Open | Fix Tauri event mocking in test environment - Add proper Tauri `__TAURI_EVENT_PLUGIN_INTERNALS__` mocking to reduce test noise (18 unhandled promise rejections). Project-wide issue, not story-specific. Test setup configuration. Estimate: 1 hour. (Duplicate of 1.6/1.7 - can be consolidated) |
| 2025-10-27 | 1.10 | 1 | Enhancement | Med | Developer | Open | Change bundle identifier to generic "com.clippy.app" - Update identifier field in src-tauri/tauri.conf.json:5 from personal "com.zeno.clippy" to generic "com.clippy.app" for more professional distribution. |
| 2025-10-27 | 1.10 | 1 | TechDebt | Med | Developer | Open | Document manual signing requirement in README - Add note that Tauri 2.x may not auto-sign with development certificates. Include manual codesign command in build instructions. Files: README.md Code Signing section, tauri.conf.json:41. |
| 2025-10-27 | 1.10 | 1 | TechDebt | Med | Developer | Open | Add integration test for build artifacts - Create test in src/test/build-integration.test.ts that checks for .app bundle and DMG existence after build. Use fs.existsSync() or shell script. |
| 2025-10-27 | 1.10 | 1 | Enhancement | Low | Developer | Open | Clarify Gatekeeper instructions in README - Emphasize right-click → Open as primary method, de-emphasize spctl disable. File: README.md:112-115. |
| 2025-10-27 | 1.10 | 1 | Enhancement | Low | Developer | Open | Add DMG file size to documentation - Document that DMG is ~5.5MB in README distribution section for user awareness. |
| 2025-10-27 | 1.10 | 1 | Enhancement | Low | Developer | Open | Consider adding npm audit/cargo audit to build - Add security vulnerability scanning to build process for production hardening. Future enhancement. |
| 2025-10-28 | 1.10 | 1 | TechDebt | Med | Developer | Open | Update ESLint config for React 19 automatic JSX - Add React plugin configuration to recognize automatic JSX runtime. Add `react/jsx-uses-react: off` and `react/react-in-jsx-scope: off` rules to eslint.config.js. Fix "React is not defined" errors in MediaImport.tsx, MediaItem.tsx, and Timeline.test.tsx. Est: 15 min. |
| 2025-10-28 | 1.10 | 1 | TechDebt | Med | Developer | Open | Clarify icon path in story documentation - Update docs/stories/1-10-production-build-app-packaging.md Dev Notes line 83 from "src-tauri/icons/" to "icons/" (project root) to match reality and tauri.conf.json. Est: 5 min. |
| 2025-10-28 | 1.10 | 1 | Enhancement | Low | Developer | Open | Migrate .eslintignore to eslint.config.js - Convert .eslintignore patterns to `ignores` array in eslint.config.js and remove .eslintignore file per ESLint 9+ deprecation. Est: 10 min. |
| 2025-10-28 | 2.1 | 2 | Documentation | High | SM/PM | Open | Generate Epic 2 Technical Specification - Create docs/tech-spec-epic-2.md documenting recording architecture, FFmpeg integration patterns, multi-stream coordination design, and audio capture strategy. Must complete before Story 2.2 development. Reference: Review finding M1. |
| 2025-10-28 | 2.1 | 2 | TechDebt | Med | Developer | Open | Refactor macOS version check to use native API - Replace sw_vers shell command with NSProcessInfo API in src-tauri/src/services/permissions/macos.rs:148-195. External process spawn adds ~10-50ms latency. Use objc/objc-foundation crates (already in Cargo.toml). Est: 2-4 hours. Reference: Review finding M3. |
| 2025-10-28 | 2.1 | 2 | Enhancement | Med | Developer | Open | Add integration test for permission flow - Create end-to-end test for check → request → capture attempt sequence. Validate error messages match UX requirements and test permission state transitions. Reference: Review test gap #1. |
| 2025-10-28 | 2.1 | 2 | Enhancement | Low | Developer | Open | Enhance Tauri command tests - Add tests for error message formats and recording lifecycle (start/stop/file verification) in src-tauri/src/commands/recording.rs:268-291. Reference: Review finding L1. |
| 2025-10-28 | 2.1 | 2 | Enhancement | Low | Developer | Open | Add error message content test - Assert PermissionError messages contain "System Preferences" text to validate AC#4 explicitly. File: src-tauri/src/services/permissions/macos.rs test section. Reference: Review finding L2. |
| 2025-10-28 | 2.1 | 2 | Enhancement | Low | Frontend | Open | Remove unnecessary permission recheck - Remove setTimeout(checkPermission, 1000) from PermissionPrompt.tsx:86 and show persistent "restart app" message instead. Permission change requires app restart so recheck is futile. Reference: Review finding L3. |
| 2025-10-29 | 2.5 | 2 | TechDebt | High | Developer | Closed | Add libc dependency to Cargo.toml - Add `libc = "0.2"` to `[dependencies]` section for explicit declaration of libc::statvfs usage in cmd_check_disk_space. Currently relying on transitive dependency which violates Rust best practices. File: src-tauri/Cargo.toml. Reference: Review finding H1, AC #8. RESOLVED: libc = "0.2" added at line 48 (2025-10-29). |
| 2025-10-29 | 2.5 | 2 | Bug | Med | Frontend | Closed | Add edge case validation in resumeRecording - Add null check for `state.startTime` before pause duration calculation in recordingStore to prevent incorrect pausedMs accumulation if state corrupted. File: src/stores/recordingStore.ts:152-162. Reference: Review finding M1, AC #5. RESOLVED: Validation added at lines 155-161, all 27 tests passing (2025-10-29). |
| 2025-10-29 | 2.5 | 2 | TechDebt | Low | Developer | Closed | Document or resolve recording output directory discrepancy - Align code path `~/Movies/clippy/recordings` (RecordingPanel.tsx:114/184) with tech spec `~/Documents/clippy/recordings` (tech-spec-epic-2.md:1056) for consistency. Impacts disk space monitoring. Reference: Review finding L2, AC #8. RESOLVED: Path corrected to ~/Documents at RecordingPanel.tsx:114,184 (2025-10-29). |
| 2025-10-29 | 2.5 | 2 | Enhancement | Low | Developer | Closed | Add safety comment to unsafe block - Add comment explaining FFI to libc::statvfs is safe due to well-defined POSIX API and validated input in cmd_check_disk_space. File: src-tauri/src/commands/recording.rs:1119-1131. Reference: Review finding (Best Practices). RESOLVED: Safety comment added at src-tauri/src/commands/recording.rs:1196-1200 (2025-10-29). |
| 2025-10-29 | 2.4 | 2 | Bug | High | Developer | Open | Fix Send trait error in webcam recording command - Make Camera type Send-safe or refactor cmd_start_webcam_recording to avoid holding camera across await. File: src/commands/recording.rs:325. Blocks compilation of entire codebase. Est: 2-4 hours. Reference: Story 2.4 Review Critical #1. |
| 2025-10-29 | 2.4 | 2 | Feature | High | Developer | Open | Implement FFmpeg multi-audio muxing - Complete AC#5 by implementing audio sample passing to FFmpeg encoder. Options: (1) temporary PCM files + post-process mux, (2) named pipes (FIFOs), or (3) multi-stdin streams. Remove 4 TODO markers in orchestrator.rs (lines 287, 314, 564, 591). Files: src/services/ffmpeg/encoder.rs, src/services/recording/orchestrator.rs. Est: 8-16 hours. Reference: Story 2.4 Review Critical #2. |
| 2025-10-29 | 2.4 | 2 | Feature | High | Developer | Open | Implement ScreenCaptureKit system audio capture - Complete AC#2 by implementing audio output handler using SCStreamOutput protocol. Remove TODO at screencapturekit.rs:533. Pass audio samples to system_audio_tx channel in orchestrator. Est: 6-12 hours. Reference: Story 2.4 Review Critical #3. |
| 2025-10-29 | 2.4 | 2 | TechDebt | Med | Developer | Open | Remove unused AudioCapture import - Remove or integrate unused import in src/commands/recording.rs:10. Code hygiene issue suggesting incomplete integration. Est: 5 min. Reference: Story 2.4 Review Important #4. |
| 2025-10-29 | 2.4 | 2 | TechDebt | Med | Developer | Open | Fix objc cfg warnings - Update objc crate or adjust macro usage in src/services/permissions/macos.rs (4 warnings). Build quality issue. Est: 30 min. Reference: Story 2.4 Review Important #5. |
| 2025-10-29 | 2.4 | 2 | TechDebt | Med | Developer | Open | Verify test claims and document actual results - Run all tests after compilation fixes and update Dev Agent Record with actual counts. Story claims 36 tests passing but cannot verify due to build errors. Reference: Story 2.4 Review Important #6. |
| 2025-10-29 | 2.4 | 2 | Enhancement | Low | Developer | Open | Add microphone permission checks - Check AVMediaTypeAudio permission before capture attempt in audio_capture.rs using permissions::macos module. Better UX when permission denied. Est: 1 hour. Reference: Story 2.4 Review Optional #7. |
| 2025-10-29 | 2.4 | 2 | Enhancement | Low | Developer | Open | Add memory limits for audio buffers - Implement bounded buffer size limits in audio_capture.rs and orchestrator.rs to prevent unbounded memory growth during long recordings. Est: 2-3 hours. Reference: Story 2.4 Review Optional #8. |
| 2025-10-28 | 2.3 | 2 | TechDebt | Med | Developer | Open | Add unit tests for FFmpegEncoder (encoder.rs) - Test initialization, frame writing, dimension validation, data size validation. File: src-tauri/src/services/ffmpeg/encoder.rs. Est: 2 hours. Improve test coverage, enable safer refactoring, catch regressions early. Reference: TD-005, Story 2.3 Review AI-001. |
| 2025-10-28 | 2.3 | 2 | TechDebt | Med | Developer | Open | Add unit tests for FrameSynchronizer (frame_synchronizer.rs) - Test drift detection, frame drop logic, long recording simulation. File: src-tauri/src/services/recording/frame_synchronizer.rs. Est: 2 hours. Validate sync algorithm correctness, test edge cases (extreme drift, rapid drops). Reference: TD-005, Story 2.3 Review AI-002. |
| 2025-10-28 | 2.3 | 2 | TechDebt | Med | Developer | Open | Add unit tests for FrameHandler (frame_handler.rs) - Test backpressure behavior, encoder integration, error propagation. File: src-tauri/src/services/screen_capture/frame_handler.rs. Est: 2 hours. Validate bounded channel behavior, test encoder failure scenarios. Reference: TD-005, Story 2.3 Review AI-003. |
| 2025-10-28 | 2.3 | 2 | Verification | Med | SM/Dev | Open | Verify integration test infrastructure exists and passes (test_encoder_integration) - Run `cargo test --test recording_integration` to confirm test exists and passes. File: src-tauri/tests/ directory. Est: 30 min. Confirm end-to-end encoding flow works before audio integration (Story 2.4). Reference: Story 2.3 Review AI-004. |
| 2025-10-28 | 2.3 | 2 | Documentation | Low | Developer | Open | Document performance characteristics in module-level docs - Add 30 FPS sustained, memory usage (240MB max) to module docs. Files: src-tauri/src/services/ffmpeg/encoder.rs, frame_handler.rs. Est: 30 min. Help future maintainers understand performance expectations. Reference: Story 2.3 Review AI-005. |
| 2025-10-28 | 2.3 | 2 | Documentation | Low | Developer | Open | Add example usage to FFmpegEncoder and FrameHandler doc comments - Improve developer experience for Epic 4 (multi-stream recording). Files: encoder.rs, frame_handler.rs. Est: 30 min. Reference: Story 2.3 Review AI-006. |
| 2025-10-29 | 3.10 | 3 | Feature | High | Developer | Open | Implement preview playback fades OR defer to new story - AC#4 blocker: Enable MPV audio output, implement dynamic audio filter application using --af option, update playerStore to apply fade filters. Either working preview playback OR explicit follow-up story created with documented limitation. Est: 8-12 hours. Files: src-tauri/src/services/mpv_player.rs, src/stores/playerStore.ts. Reference: Story 3.10 Review H1, AC#4. |
| 2025-10-29 | 3.10 | 3 | TechDebt | High | Developer | Open | Add component and integration tests for fade functionality - Add fade handle component tests (rendering, drag interaction, validation, hover states), FFmpeg export integration tests (filter syntax, single/multi-clip export, filter chain order, edge cases). Est: 6-8 hours. Files: src/components/timeline/TimelineClip.test.tsx, src-tauri/src/services/ffmpeg/exporter.rs (cargo test). Reference: Story 3.10 Review H2, AC#1-6. |
| 2025-10-29 | 3.10 | 3 | TechDebt | Med | Developer | Open | Fix TimelineClip test failures - Update all TimelineClip test cases to include required trackId prop (from Story 3.3). Quick fix to unblock CI/CD. Est: 30 min. File: src/components/timeline/TimelineClip.test.tsx. Reference: Story 3.10 Review M1. |
| 2025-10-29 | 3.10 | 3 | TechDebt | Med | Developer | Open | Remove unused deltaY variable - Remove unused variable or add comment explaining purpose at TimelineClip.tsx:226. Code quality issue. Est: 5 min. File: src/components/timeline/TimelineClip.tsx:226. Reference: Story 3.10 Review M2. |
| 2025-10-29 | 3.10 | 3 | TechDebt | Med | Developer | Open | Enhance fade validation logic - Add validation for negative values, max 5s duration (5000ms per AC#3), and clip boundaries. Est: 1 hour. File: src/lib/timeline/clipOperations.ts. Reference: Story 3.10 Review M3. |
| 2025-10-29 | 3.10 | 3 | Enhancement | Low | Developer | Open | Add fade duration tooltips during drag - Consider adding tooltips in future story (Epic 3 polish pass). Not critical for MVP. Est: 2-3 hours. Reference: Story 3.10 Review L1, Subtask 2.4 (deferred). |
| 2025-10-29 | 3.10 | 3 | Documentation | Low | Developer | Open | Document manual export testing procedure - Document testing procedure (import 2 clips, add fades, export, verify with FFprobe). Consider integration test that checks FFmpeg command syntax. Est: 30 min. Files: docs/testing/ or story notes. Reference: Story 3.10 Review L3. |
| 2025-10-29 | 3.10 | 3 | Enhancement | Low | Frontend | Open | Clip properties panel with numeric fade inputs - Defer to Epic 3 or 4 when building clip properties panel. Requires full properties panel implementation. Est: 4-6 hours. Reference: Story 3.10 Review (Low Priority #8), Subtask 2.6 (deferred). |
