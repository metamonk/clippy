# Engineering Backlog

This backlog collects cross-cutting or future action items that emerge from reviews and planning.

Routing guidance:

- Use this file for non-urgent optimizations, refactors, or follow-ups that span multiple stories/epics.
- Must-fix items to ship a story belong in that story's `Tasks / Subtasks`.
- Same-epic improvements may also be captured under the epic Tech Spec `Post-Review Follow-ups` section.

| Date | Story | Epic | Type | Severity | Owner | Status | Notes |
| ---- | ----- | ---- | ---- | -------- | ----- | ------ | ----- |
| 2025-10-27 | 1.2 | 1 | TechDebt | Med | SM/PM | Open | Wire menu actions (Import, Save, Undo, Redo, Close) to Tauri commands. Menu structure exists in src-tauri/src/lib.rs:72-123 but items have no event handlers. Story 1.2 intentionally left these non-functional. Reference: Story 1.3+ should implement File→Import handler. |
| 2025-10-27 | 1.2 | 1 | Enhancement | Low | Developer | Open | Add aria-describedby to layout panel empty states for improved screen reader support. Files: src/components/layout/*.tsx. Example: add unique IDs to empty state paragraphs and reference via aria-describedby attribute. |
| 2025-10-27 | 1.2 | 1 | Enhancement | Low | Developer | Open | Enable stricter TypeScript compiler options (strict: true, noUncheckedIndexedAccess: true) in tsconfig.json to catch more type errors at compile time. |
| 2025-10-27 | 1.3 | 1 | TechDebt | Low | Developer | Open | Add path traversal validation - Canonicalize paths and validate against allowlist in src-tauri/src/commands/media.rs:16. Low risk due to Tauri sandbox but explicit validation is best practice. |
| 2025-10-27 | 1.3 | 1 | Enhancement | Low | Developer | Open | Add resource limits for imports - Max file size (5GB) and concurrent import limit (3) to prevent resource exhaustion. File: src-tauri/src/commands/media.rs. |
| 2025-10-27 | 1.3 | 1 | TechDebt | Low | Developer | Open | Add integration test with real video file - Create minimal valid MP4 for end-to-end FFmpeg metadata extraction test. Current tests only use dummy files. |
| 2025-10-27 | 1.3 | 1 | TechDebt | Low | Developer | Open | Improve test consistency - Either use Vitest globals everywhere or explicit imports everywhere. Currently mixing both patterns across test files. |
| 2025-10-27 | 1.4 | 1 | TechDebt | Med | Developer | Open | Explicit Video.js event listener cleanup - Extract event handlers to named functions and unregister in cleanup. File: src/components/player/VideoPlayer.tsx:64-86. Prevents potential memory leaks in edge cases. |
| 2025-10-27 | 1.4 | 1 | TechDebt | Med | Developer | Open | Resolve time unit inconsistency - Clarify documentation about seconds vs milliseconds, add conversion utilities if needed. Files: src/lib/utils/timeUtils.ts, src/stores/playerStore.ts. MediaFile.duration uses milliseconds but playerStore uses seconds. |
| 2025-10-27 | 1.4 | 1 | Enhancement | Low | Developer | Open | Optimize useEffect dependencies - Remove stable Zustand actions from dependencies, wrap callbacks in useCallback. File: src/components/player/VideoPlayer.tsx:89. Prevents unnecessary re-initialization. |
| 2025-10-27 | 1.4 | 1 | Enhancement | Low | Developer | Open | Enhance error handling with toast notifications - Add toast notifications for Video.js errors using sonner. File: src/components/player/VideoPlayer.tsx:83-85. Improves user experience. |
| 2025-10-27 | 1.4 | 1 | Enhancement | Low | Developer | Open | Add integration test for complete player flow - Add E2E test: MediaItem click → store update → VideoPlayer renders → plays. Validates complete feature integration. |
| 2025-10-27 | 1.6 | 1 | TechDebt | Low | Developer | Open | Refactor timeline store duration calculation to DRY helper function - Extract `_calculateTotalDuration(tracks: Track[]): number` in src/stores/timelineStore.ts. Repeated 5 times across addClip, removeClip, updateClip, removeTrack, recalculateDuration (lines 86-92, 112-118, 144-151, 198-204, 230-236). |
| 2025-10-27 | 1.6 | 1 | Enhancement | Low | Developer | Open | Add upper bound validation for timeline drop positions - Add validation/warning for extreme positions (e.g., > 24 hours) in src/components/timeline/Timeline.tsx:48-90 (handleDrop). Currently only prevents negative via Math.max(0, dropTimeMs). |
| 2025-10-27 | 1.6 | 1 | TechDebt | Med | Developer | Open | Add Tauri API mocks to test setup - Mock `window.__TAURI_INTERNALS__` in src/test/setup.ts to eliminate 18 unhandled promise rejections from @tauri-apps/api/event.js:77. Prevents test errors from masking real failures. |
| 2025-10-27 | 1.6 | 1 | TechDebt | Med | Developer | Open | Wrap MediaLibraryPanel test state updates in act() - Fix React state update warnings in src/components/media-library/MediaLibraryPanel.test.tsx. Use act() or waitFor() from @testing-library/react for state-changing interactions. |
| 2025-10-27 | 1.6 | 1 | Enhancement | Low | Developer | Open | Add useMemo for timeline width calculation - Optimize src/components/timeline/Timeline.tsx:40-43 to prevent recalculation on every render. Defer to Story 3.6 (Timeline Zoom) performance work. |
| 2025-10-27 | 1.7 | 1 | TechDebt | Low | Developer | Open | Add Tauri mock utilities to test setup - Mock `window.__TAURI_INTERNALS__` in src/test/setup.ts to suppress 18 unhandled rejection warnings from @tauri-apps/api. Cleaner test output, easier to spot real errors. |
| 2025-10-27 | 1.7 | 1 | Enhancement | Low | Developer | Open | Add explicit performance test for scrubbing latency - Measure time between drag event and video seek completion in src/components/timeline/Timeline.test.tsx. Explicit validation of NFR001 (< 100ms target). |
| 2025-10-27 | 1.7 | 1 | TechDebt | Low | Developer | Open | Wrap state updates in act() for MediaLibraryPanel tests - Use `act()` wrapper for file removal test in src/components/media-library/MediaLibraryPanel.test.tsx to eliminate test pollution warnings. |
| 2025-10-27 | 1.8 | 1 | Enhancement | Low | Developer | Open | Consider debouncing updateClip during drag - Update visual feedback immediately via local state, commit to store on drag end. Could optimize for very large timelines. File: src/components/timeline/TimelineClip.tsx:107-120, 138-152. Estimate: 1-2 hours. |
| 2025-10-27 | 1.8 | 1 | TechDebt | Low | Developer | Open | Extract magic number MIN_TRIM_GAP_MS - Replace hard-coded 100ms with named constant: `const MIN_TRIM_GAP_MS = 100; // Minimum gap to prevent zero-duration clips`. File: src/components/timeline/TimelineClip.tsx:117, 149. Estimate: 5 minutes. |
| 2025-10-27 | 1.8 | 1 | TechDebt | Low | Developer | Open | Fix Tauri event mocking in test environment - Add proper Tauri `__TAURI_EVENT_PLUGIN_INTERNALS__` mocking to reduce test noise (18 unhandled promise rejections). Project-wide issue, not story-specific. Test setup configuration. Estimate: 1 hour. (Duplicate of 1.6/1.7 - can be consolidated) |
| 2025-10-27 | 1.10 | 1 | Enhancement | Med | Developer | Open | Change bundle identifier to generic "com.clippy.app" - Update identifier field in src-tauri/tauri.conf.json:5 from personal "com.zeno.clippy" to generic "com.clippy.app" for more professional distribution. |
| 2025-10-27 | 1.10 | 1 | TechDebt | Med | Developer | Open | Document manual signing requirement in README - Add note that Tauri 2.x may not auto-sign with development certificates. Include manual codesign command in build instructions. Files: README.md Code Signing section, tauri.conf.json:41. |
| 2025-10-27 | 1.10 | 1 | TechDebt | Med | Developer | Open | Add integration test for build artifacts - Create test in src/test/build-integration.test.ts that checks for .app bundle and DMG existence after build. Use fs.existsSync() or shell script. |
| 2025-10-27 | 1.10 | 1 | Enhancement | Low | Developer | Open | Clarify Gatekeeper instructions in README - Emphasize right-click → Open as primary method, de-emphasize spctl disable. File: README.md:112-115. |
| 2025-10-27 | 1.10 | 1 | Enhancement | Low | Developer | Open | Add DMG file size to documentation - Document that DMG is ~5.5MB in README distribution section for user awareness. |
| 2025-10-27 | 1.10 | 1 | Enhancement | Low | Developer | Open | Consider adding npm audit/cargo audit to build - Add security vulnerability scanning to build process for production hardening. Future enhancement. |
| 2025-10-28 | 1.10 | 1 | TechDebt | Med | Developer | Open | Update ESLint config for React 19 automatic JSX - Add React plugin configuration to recognize automatic JSX runtime. Add `react/jsx-uses-react: off` and `react/react-in-jsx-scope: off` rules to eslint.config.js. Fix "React is not defined" errors in MediaImport.tsx, MediaItem.tsx, and Timeline.test.tsx. Est: 15 min. |
| 2025-10-28 | 1.10 | 1 | TechDebt | Med | Developer | Open | Clarify icon path in story documentation - Update docs/stories/1-10-production-build-app-packaging.md Dev Notes line 83 from "src-tauri/icons/" to "icons/" (project root) to match reality and tauri.conf.json. Est: 5 min. |
| 2025-10-28 | 1.10 | 1 | Enhancement | Low | Developer | Open | Migrate .eslintignore to eslint.config.js - Convert .eslintignore patterns to `ignores` array in eslint.config.js and remove .eslintignore file per ESLint 9+ deprecation. Est: 10 min. |
| 2025-10-28 | 2.1 | 2 | Documentation | High | SM/PM | Open | Generate Epic 2 Technical Specification - Create docs/tech-spec-epic-2.md documenting recording architecture, FFmpeg integration patterns, multi-stream coordination design, and audio capture strategy. Must complete before Story 2.2 development. Reference: Review finding M1. |
| 2025-10-28 | 2.1 | 2 | TechDebt | Med | Developer | Open | Refactor macOS version check to use native API - Replace sw_vers shell command with NSProcessInfo API in src-tauri/src/services/permissions/macos.rs:148-195. External process spawn adds ~10-50ms latency. Use objc/objc-foundation crates (already in Cargo.toml). Est: 2-4 hours. Reference: Review finding M3. |
| 2025-10-28 | 2.1 | 2 | Enhancement | Med | Developer | Open | Add integration test for permission flow - Create end-to-end test for check → request → capture attempt sequence. Validate error messages match UX requirements and test permission state transitions. Reference: Review test gap #1. |
| 2025-10-28 | 2.1 | 2 | Enhancement | Low | Developer | Open | Enhance Tauri command tests - Add tests for error message formats and recording lifecycle (start/stop/file verification) in src-tauri/src/commands/recording.rs:268-291. Reference: Review finding L1. |
| 2025-10-28 | 2.1 | 2 | Enhancement | Low | Developer | Open | Add error message content test - Assert PermissionError messages contain "System Preferences" text to validate AC#4 explicitly. File: src-tauri/src/services/permissions/macos.rs test section. Reference: Review finding L2. |
| 2025-10-28 | 2.1 | 2 | Enhancement | Low | Frontend | Open | Remove unnecessary permission recheck - Remove setTimeout(checkPermission, 1000) from PermissionPrompt.tsx:86 and show persistent "restart app" message instead. Permission change requires app restart so recheck is futile. Reference: Review finding L3. |
| 2025-10-28 | 2.3 | 2 | TechDebt | Med | Developer | Open | Add unit tests for FFmpegEncoder (encoder.rs) - Test initialization, frame writing, dimension validation, data size validation. File: src-tauri/src/services/ffmpeg/encoder.rs. Est: 2 hours. Improve test coverage, enable safer refactoring, catch regressions early. Reference: TD-005, Story 2.3 Review AI-001. |
| 2025-10-28 | 2.3 | 2 | TechDebt | Med | Developer | Open | Add unit tests for FrameSynchronizer (frame_synchronizer.rs) - Test drift detection, frame drop logic, long recording simulation. File: src-tauri/src/services/recording/frame_synchronizer.rs. Est: 2 hours. Validate sync algorithm correctness, test edge cases (extreme drift, rapid drops). Reference: TD-005, Story 2.3 Review AI-002. |
| 2025-10-28 | 2.3 | 2 | TechDebt | Med | Developer | Open | Add unit tests for FrameHandler (frame_handler.rs) - Test backpressure behavior, encoder integration, error propagation. File: src-tauri/src/services/screen_capture/frame_handler.rs. Est: 2 hours. Validate bounded channel behavior, test encoder failure scenarios. Reference: TD-005, Story 2.3 Review AI-003. |
| 2025-10-28 | 2.3 | 2 | Verification | Med | SM/Dev | Open | Verify integration test infrastructure exists and passes (test_encoder_integration) - Run `cargo test --test recording_integration` to confirm test exists and passes. File: src-tauri/tests/ directory. Est: 30 min. Confirm end-to-end encoding flow works before audio integration (Story 2.4). Reference: Story 2.3 Review AI-004. |
| 2025-10-28 | 2.3 | 2 | Documentation | Low | Developer | Open | Document performance characteristics in module-level docs - Add 30 FPS sustained, memory usage (240MB max) to module docs. Files: src-tauri/src/services/ffmpeg/encoder.rs, frame_handler.rs. Est: 30 min. Help future maintainers understand performance expectations. Reference: Story 2.3 Review AI-005. |
| 2025-10-28 | 2.3 | 2 | Documentation | Low | Developer | Open | Add example usage to FFmpegEncoder and FrameHandler doc comments - Improve developer experience for Epic 4 (multi-stream recording). Files: encoder.rs, frame_handler.rs. Est: 30 min. Reference: Story 2.3 Review AI-006. |
